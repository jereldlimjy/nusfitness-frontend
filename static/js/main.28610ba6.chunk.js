(this.webpackJsonpnusfitness=this.webpackJsonpnusfitness||[]).push([[0],{357:function(e,t,n){},358:function(e,t,n){},490:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),s=n(25),r=n.n(s),o=(n(357),n(23)),i=n(330),l=n(576),u=n(559),d=n(46),j=n(34),b=(n(358),n(582)),h=n(4),m=function(e){var t=e.alert;return null!==t&&Object(h.jsx)(b.a,{severity:t.type,children:t.msg})},p=n(146),f=n(86),O=n(579),g=n(245),x=n(495),y=n(503),v=n(502),k=n(587),w=n(552),S=n(553),C=n(584),T=n(554),D=n(555),N=n(549),L=n(106),E=(n(364),n(365),n(307)),I=function(e){var t=e.selectedDates,n=e.setSelectedDates;return Object(h.jsx)(E.DateRange,{onChange:function(e){return n([e.selection])},showSelectionPreview:!0,moveRangeOnFirstSelection:!1,months:1,maxDate:new Date,ranges:t,direction:"horizontal"})},F=n(581),A=n(586),B=n(583),H=n(585),R=n(593),P=n(577),W=function(e){var t=e.setTime,n=e.data,a=e.chartTitle,c=[t(8,0),t(9,0),t(10,0),t(11,0),t(12,0),t(13,0),t(14,0),t(15,0),t(16,0),t(17,0),t(18,0),t(19,0),t(20,0),t(21,0)];return Object(h.jsxs)(F.a,{theme:A.a.material,containerComponent:Object(h.jsx)(B.a,{labels:function(e){return"Time: ".concat(e.datum.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),", Count: ").concat(e.datum.count)},radius:25}),minDomain:{x:t(7,0),y:0},maxDomain:{x:t(22,0),y:40},height:250,width:900,padding:{top:0,right:25,bottom:0,left:50},children:[Object(h.jsx)(H.a,{text:a,x:450,y:-30,textAnchor:"middle",style:{fontSize:18}}),Object(h.jsx)(R.a,{label:"Time",tickValues:c,tickFormat:function(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")},axisLabelComponent:Object(h.jsx)(H.a,{dy:30})}),Object(h.jsx)(R.a,{dependentAxis:!0,label:"Capacity",axisLabelComponent:Object(h.jsx)(H.a,{dy:-30})}),Object(h.jsx)(P.a,{data:n,x:"date",y:"count",scale:{x:"time",y:"linear"}})]})},M=Object(N.a)((function(e){var t;return{root:(t={},Object(f.a)(t,e.breakpoints.down("xs"),{flexDirection:"column"}),Object(f.a)(t,"padding",e.spacing(2)),Object(f.a)(t,"& .MuiCheckbox-colorPrimary.Mui-checked",{color:"rgb(61, 145, 255)"}),t),formControl:{marginTop:e.spacing(1),width:"100%"},selectButton:{backgroundColor:"rgb(61, 145, 255)"}}})),U=function(){var e=M(),t=["Kent Ridge Swimming Pool","University Town Swimming Pool","Kent Ridge Gym","University Sports Centre Gym","University Town Gym","Wellness Outreach Gym"],n=function(e,t){var n=new Date;return n.setHours(e,t,0,0),n},c=Object(a.useState)(t[0]),s=Object(o.a)(c,2),r=s[0],i=s[1],l=Object(a.useState)([]),u=Object(o.a)(l,2),d=u[0],j=u[1],b=Object(a.useState)([{startDate:n(0,0),endDate:n(0,0),key:"selection"}]),m=Object(o.a)(b,2),f=m[0],N=m[1],E=Object(a.useState)([1,2,3,4,5,6,7]),F=Object(o.a)(E,2),A=F[0],B=F[1],H=Object(a.useState)(""),R=Object(o.a)(H,2),P=R[0],U=R[1],J=function(e){var t=e.target;t.checked?B([].concat(Object(p.a)(A),[parseInt(t.value)])):B(A.filter((function(e){return e!==parseInt(t.value)})))},G=function(e){switch(e.target.innerText){case"SELECT ALL":B([1,2,3,4,5,6,7]);break;case"REMOVE ALL":B([]);break;case"WEEKDAYS":B([2,3,4,5,6]);break;case"WEEKENDS":B([1,7])}};return Object(a.useEffect)((function(){var e=Object(o.a)(f,1)[0],n=e.startDate,a=Object(L.default)(e.endDate,1),c="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","traffic");fetch(c,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:t.indexOf(r),date:{$gte:n,$lte:a},day:A}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){return j(e.map((function(e){return{date:new Date(e.date),count:e.count}})))}))}),[r,f,A]),Object(a.useEffect)((function(){U("".concat(r,"\n").concat(f[0].startDate.toDateString()," to ").concat(f[0].endDate.toDateString()," "))}),[r,f,A]),Object(h.jsxs)(O.a,{display:"flex",className:e.root,children:[Object(h.jsxs)(O.a,{display:"flex",flex:"1 1 0",flexDirection:"column",maxWidth:"370px",className:e.root,children:[Object(h.jsx)(g.a,{variant:"h4",children:"Filters"}),Object(h.jsxs)(O.a,{width:"100%",mt:2,mb:2,children:[Object(h.jsx)(g.a,{variant:"h6",children:"Facility"}),Object(h.jsxs)(x.a,{variant:"outlined",className:e.formControl,children:[Object(h.jsx)(y.a,{id:"facility-label",children:"Select Facility"}),Object(h.jsx)(v.a,{value:r,labelId:"facility-label",id:"facility",onChange:function(e){i(e.target.value)},label:"Select Facility",children:t.map((function(e){return Object(h.jsx)(k.a,{value:e,children:e},e)}))})]})]}),Object(h.jsxs)(O.a,{mt:1,children:[Object(h.jsx)(g.a,{variant:"h6",children:"Date Range"}),Object(h.jsx)(I,{selectedDates:f,setSelectedDates:N})]}),Object(h.jsxs)(x.a,{children:[Object(h.jsx)(g.a,{variant:"h6",children:"Days of week"}),Object(h.jsx)(w.a,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((function(e,t){return Object(h.jsx)(S.a,{control:Object(h.jsx)(C.a,{value:t+1,checked:A.includes(t+1),onChange:J,id:e,color:"primary"},e+e),label:e})}))})]}),Object(h.jsx)(T.a,{container:!0,spacing:1,justify:"flex-start",children:["SELECT ALL","REMOVE ALL","WEEKDAYS","WEEKENDS"].map((function(t){return Object(h.jsx)(T.a,{item:!0,xs:6,children:Object(h.jsx)(D.a,{variant:"contained",fullWidth:!0,onClick:G,className:e.selectButton,children:t})})}))})]}),Object(h.jsx)(O.a,{flex:"3 0 0",children:Object(h.jsx)(W,{setTime:n,data:d,chartTitle:P})})]})},J=n(570),G=n(556),Y=n(43),K=n(31),q=n.n(K),V=n(62),_=n(204),z=n(588),$=n(567),Q=n(571),X=n(568),Z=n(573),ee=n(569),te=n(558),ne=n(198),ae=n(557),ce=Object(N.a)((function(e){return{root:{margin:e.spacing(.5)},slot:{display:"none","&[disabled] ~ label":{color:"rgb(170, 170, 170)"},"&[booked='true'] ~ label":{backgroundColor:G.a[200]},"&[booked='true']:checked ~ label":{backgroundColor:ne.a[400]},"&:checked ~ label":{backgroundColor:ne.a[400]}},slotLabel:{display:"inline-block",boxSizing:"border-box",margin:0,padding:"5px 20px",width:"100%",cursor:"pointer"}}})),se=function(e){var t=e.date,n=e.handleChange,a=e.checked,c=e.booked,s=e.slotsLeft,r=ce(),o=Object(ae.a)(t,1),i=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),l=(new Date).getTime();return Object(h.jsxs)(te.a,{className:r.root,children:[Object(h.jsx)("input",{type:"checkbox",className:r.slot,id:t,date:t,onChange:n,checked:a,disabled:o<=l,booked:c.toString()}),Object(h.jsx)("label",{className:r.slotLabel,htmlFor:t,children:Object(h.jsx)("strong",{children:i})}),Object(h.jsx)("label",{className:r.slotLabel,htmlFor:t,children:"".concat(s," Left")})]})},re=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},box:{display:"flex",flexDirection:"row",flexWrap:"wrap"}}})),oe=function(e){e.facility;var t=e.assignedDate,n=e.hours,a=e.handleChange,c=e.selectedSlot,s=e.bookedSlots,r=e.slotCount,o=re();return Object(h.jsxs)("div",{className:o.root,children:[Object(h.jsx)(g.a,{variant:"h5",children:t.toDateString()}),Object(h.jsx)(O.a,{className:o.box,children:n.map((function(e){var n=parseInt(e.slice(0,2)),o=parseInt(e.slice(2,4)),i=new Date(t);i.setHours(n,o,0,0);var l=40,u=r.find((function(e){return e.date.getTime()===i.getTime()}));return u&&(l=40-u.count),Object(h.jsx)(se,{date:i,handleChange:a,checked:c.date&&c.date.getTime()===i.getTime(),booked:s.filter((function(e){return e.date.getTime()===i.getTime()})).length>0,slotsLeft:l},i.toLocaleString())}))})]})},ie=n(244),le=n(75),ue=n(589),de=n(566),je=n(199),be=n(197),he=n(572),me=n(202),pe=n(331),fe=n(327),Oe=n.n(fe),ge={"Design Lecture":"DLEC",Laboratory:"LAB",Lecture:"LEC","Packaged Lecture":"PLEC","Packaged Tutorial":"PTUT",Recitation:"REC","Sectional Teaching":"SEC","Seminar-Style Module Class":"SEM",Tutorial:"TUT","Tutorial Type 2":"TUT2","Tutorial Type 3":"TUT3",Workshop:"WS"},xe=Object(me.invert)(ge),ye={"Semester 1":1,"Semester 2":2,"Special Term I":3,"Special Term II":4},ve={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},ke=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},container:{width:"100%",height:"100%",padding:0},title:{fontWeight:"600"},timeTableCell:{height:"66px"},timeLabel:{height:"66px",lineHeight:"64px","&:first-child":{height:"33px"},"&:last-child":{height:"33px"}},inputContainer:{display:"flex",marginBottom:e.spacing(2)},timetableButton:{marginRight:e.spacing(2),backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[700]}},lessonsButton:{marginRight:e.spacing(2),backgroundColor:G.a[400],"&:hover":{backgroundColor:G.a[500]}},inputField:{marginRight:e.spacing(2)},select:{minWidth:200,marginRight:e.spacing(2)}}})),we=function(e){var t=e.style,n=Object(ie.a)(e,["style"]),a=n.data.isLesson?je.a[400]:be.a[400];return Object(h.jsx)(le.a.Appointment,Object(Y.a)(Object(Y.a)({},n),{},{style:Object(Y.a)(Object(Y.a)({},t),{},{backgroundColor:a})}))},Se=function(e){var t=e.data,n=Object(ie.a)(e,["data"]),a=ke();return Object(h.jsx)(le.a.AppointmentContent,Object(Y.a)(Object(Y.a)({},n),{},{data:t,children:Object(h.jsxs)("div",{className:a.container,children:[Object(h.jsx)("div",{className:a.title,children:t.title}),Object(h.jsx)("div",{children:t.lessonType}),Object(h.jsx)("div",{children:t.location})]})}))},Ce=function(e){var t=ke();return Object(h.jsx)(le.d.TimeTableCell,Object(Y.a)(Object(Y.a)({},e),{},{className:t.timeTableCell}))},Te=function(e){var t=ke();return Object(h.jsx)(le.d.TimeScaleLabel,Object(Y.a)(Object(Y.a)({},e),{},{formatDate:function(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")},className:t.timeLabel}))},De=function(e){var t=ke();return Object(h.jsx)(le.d.TimeScaleTickCell,Object(Y.a)(Object(Y.a)({},e),{},{className:t.timeTableCell}))},Ne=function(e){var t=e.bookedSlots,n=Object(a.useState)(!1),c=Object(o.a)(n,2),s=c[0],r=c[1],i=Object(a.useState)(!0),l=Object(o.a)(i,2),u=l[0],d=l[1],j=Object(a.useState)(0),b=Object(o.a)(j,2),m=b[0],f=b[1],g=Object(a.useState)("https://nusmods.com/timetable/st-i/share?TBA2101=TUT:2,LEC:1"),x=Object(o.a)(g,2),y=x[0],v=x[1],w=Object(a.useState)(!1),S=Object(o.a)(w,2),C=S[0],T=S[1],N=Object(a.useState)([]),E=Object(o.a)(N,2),I=E[0],F=E[1],A=ke(),B=function(){var e=y.match(/sem-[1|2]/),t=y.match(/st-i{2}\/|st-i\//);if(e||t){if(e)return T(!1),parseInt(e[0].slice(4,5));if(t)return T(!1),5===t[0].length?3:4}else T(!0)},H=function(){var e=y.match(/\?\S*/);if(e){T(!1);var t=Oe.a.parse(e[0]);return Object(me.mapValues)(t,R)}T(!0)},R=function(e){var t={};return e?(Object(me.castArray)(e).forEach((function(e){e.split(",").forEach((function(e){var n=e.split(":"),a=Object(o.a)(n,2),c=a[0],s=a[1],r=xe[c];r&&(t[r]=s)}))})),t):t},P=function(e){var t=(e=new Date(e)).getDay(),n=e.getDate()-t;return new Date(e.setDate(n))},W=function(){var e=Object(V.a)(q.a.mark((function e(t,n){var a,c,s,r,i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=P(new Date),c=[],s=q.a.mark((function e(){var n,s,l;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(o.a)(i[r],2),s=n[0],l=n[1],e.next=3,fetch("https://api.nusmods.com/v2/2021-2022/modules/".concat(s,".json"),{method:"get"}).then((function(e){return e.json()})).then((function(e){var n=e.semesterData.filter((function(e){return e.semester===t})),r=Object(o.a)(n,1)[0];if(r){var i=Object.keys(l).flatMap((function(e){return r.timetable.filter((function(t){return t.classNo===l[e]&&t.lessonType===e}))}));if(!u){var d=pe.a.academicCalendar.getAcadWeekInfo(new Date),j=ye[d.sem],b=d.num;i=i.filter((function(e){return j===t&&e.weeks.includes(b)}))}var h=i.map((function(e){var t=s,n=parseInt(e.startTime.slice(0,2)),c=parseInt(e.startTime.slice(2,4)),r=parseInt(e.endTime.slice(0,2)),o=parseInt(e.endTime.slice(2,4)),i=Object(L.default)(a,ve[e.day]),l=Object(L.default)(a,ve[e.day]);i.setHours(n,c,0,0),l.setHours(r,o,0,0);return{title:t,startDate:i,endDate:l,lessonType:"".concat(ge[e.lessonType]," [").concat(e.classNo,"]"),location:e.venue,isLesson:!0}}));c=c.concat(h)}else T(!0)}));case 3:case"end":return e.stop()}}),e)})),r=0,i=Object.entries(n);case 4:if(!(r<i.length)){e.next=9;break}return e.delegateYield(s(),"t0",6);case 6:r++,e.next=4;break;case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){(function(){var e=Object(V.a)(q.a.mark((function e(){var n,a,c,s;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=B()){e.next=3;break}return e.abrupt("return");case 3:if(a=H()){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,W(n,a);case 8:return c=e.sent,e.next=11,t=t.map((function(e){var t=new Date(e.date),n=0===t.getMinutes()?Object(ae.a)(t,1):Object(he.a)(Object(ae.a)(t,1),30);return{title:"Facility Booking",startDate:t,endDate:n,location:e.facility,isLesson:!1}}));case 11:s=e.sent,F([].concat(Object(p.a)(c),Object(p.a)(s)));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[y,u,t]);return Object(h.jsxs)(O.a,{className:A.root,children:[Object(h.jsxs)(O.a,{className:A.inputContainer,children:[Object(h.jsx)(D.a,{onClick:function(){r(!s)},variant:"contained",className:A.timetableButton,children:s?"Hide Timetable":"Show Timetable"}),s&&Object(h.jsx)(ue.a,{title:u?"Only show lessons which occur during the current academic week":"Show lessons regardless of academic week",children:Object(h.jsx)(D.a,{onClick:function(){d(!u)},variant:"contained",color:"secondary",className:A.lessonsButton,children:u?"Hide Lessons":"Always Show Lessons"})}),s&&Object(h.jsxs)(de.a,{select:!0,label:"First Day of Week",variant:"outlined",className:A.select,onChange:function(e){return f(e.target.value)},value:m,children:[Object(h.jsx)(k.a,{value:0,children:"Sunday"}),Object(h.jsx)(k.a,{value:1,children:"Monday"})]}),s&&Object(h.jsx)(de.a,{error:C,label:C?"Error":"NUSMods Share Link",helperText:C?"Invalid Link":"",value:y,variant:"outlined",onChange:function(e){return v(e.target.value)},className:A.inputField})]}),s&&Object(h.jsx)(_.a,{children:Object(h.jsxs)(le.c,{firstDayOfWeek:m,data:I,children:[Object(h.jsx)(le.d,{startDayHour:7,endDayHour:22,cellDuration:60,timeTableCellComponent:Ce,timeScaleLabelComponent:Te,timeScaleTickCellComponent:De}),Object(h.jsx)(le.a,{appointmentComponent:we,appointmentContentComponent:Se}),Object(h.jsx)(le.b,{})]})})]})},Le=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},box:{display:"flex",justifyContent:"center"},formControl:{margin:e.spacing(1),width:"50%"},button:{padding:e.spacing(1.5,2),cursor:"pointer",border:0,borderRadius:5,backgroundColor:u.a[600],color:"white","&:hover":{backgroundColor:u.a[800]}},circularProgress:{marginBottom:e.spacing(1.5),color:G.a[200]},paper:{marginLeft:e.spacing(2),marginRight:e.spacing(2),paddingBottom:e.spacing(2)},header:{paddingTop:e.spacing(2)}}})),Ee=[{name:"Kent Ridge Swimming Pool",weekdayHours:["0730","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"University Town Swimming Pool",weekdayHours:["0730","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"Kent Ridge Gym",weekdayHours:["1100","1200","1300","1400","1500","1600","1700","1800","1900"],weekendHours:[]},{name:"University Sports Centre Gym",weekdayHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"University Town Gym",weekdayHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"],weekendHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"]},{name:"Wellness Outreach Gym",weekdayHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"],weekendHours:[]}],Ie=function(e){var t=e.handleAlert,n=Le(),c=Object(a.useState)(Ee[0]),s=Object(o.a)(c,2),r=s[0],i=s[1],l=Object(a.useState)({}),u=Object(o.a)(l,2),d=u[0],b=u[1],m=Object(a.useState)([]),p=Object(o.a)(m,2),f=p[0],w=p[1],S=Object(a.useState)([]),C=Object(o.a)(S,2),T=C[0],N=C[1],E=Object(a.useState)([]),I=Object(o.a)(E,2),F=I[0],A=I[1],B=Object(a.useState)("Book"),H=Object(o.a)(B,2),R=H[0],P=H[1],W=Object(a.useState)(!1),M=Object(o.a)(W,2),U=M[0],G=M[1],K=Object(a.useState)(),te=Object(o.a)(K,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),se=Object(o.a)(ce,2),re=se[0],ie=se[1],le=Object(j.f)(),ue=new Date,de=ue.getDay();console.log(le.location.state),Object(a.useEffect)((function(){function e(){return(e=Object(V.a)(q.a.mark((function e(){var t,n,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","creditsLeft"),ie(!0),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,ae(a.credits);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var je=function(e){var t=e.target;t.checked?b({date:new Date(t.attributes.date.value)}):b({});var n={date:new Date(t.attributes.date.value)};0!==Object.keys(n).length&&(f.find((function(e){return e.date.getTime()===n.date.getTime()}))?P("Cancel"):P("Book"))},be=function(){var e=Object(V.a)(q.a.mark((function e(){var t,n,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots"),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:r.name}),credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,w(a.map((function(e){return{facility:e.facility,date:new Date(e.date)}}))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),he=new Date(ue.getFullYear(),ue.getMonth(),ue.getDate()),me=function(){var e=Object(V.a)(q.a.mark((function e(){var t,n,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","slots"),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:r.name,startDate:he,endDate:Object(L.default)(he,3)}),credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,A(a.map((function(e){return{date:new Date(e._id),count:e.count}}))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)(Object(V.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie(!0),e.next=3,be();case 3:return e.next=5,me();case 5:ie(!1);case 6:case"end":return e.stop()}}),e)}))),[r]);for(var pe=Object(a.useCallback)(function(){var e=Object(V.a)(q.a.mark((function e(n){var a,c,s,o,i,l;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),b({}),a=function(){var e=Object(V.a)(q.a.mark((function e(){var t,n,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots"),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,N(a.map((function(e){return{facility:e.facility,date:new Date(e.date)}}))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),"Cancel"!==R){e.next=29;break}return e.prev=4,c="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","cancel"),ie(!0),e.next=9,fetch(c,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(Y.a)({facility:r.name},d)),credentials:"include"});case 9:return 401===(s=e.sent).status?t("You are unauthorised to cancel the slot. Please contact the website's administrator","error"):403===s.status?t("Unable to cancel slot because it is within the 2 hour cancellation window.","error"):404===s.status&&t("Slot cannot be found. Please contact the website's administrator","error"),e.next=13,s.json();case 13:return e.sent.success&&t("Your slot has been cancelled.","success"),e.next=17,be();case 17:return e.next=19,a();case 19:return e.next=21,me();case 21:ie(!1),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(4),console.log(e.t0);case 27:e.next=67;break;case 29:return e.prev=29,o="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000":"https://salty-reaches-24995.herokuapp.com"),ie(!0),e.next=34,fetch("".concat(o,"/updateCredits"),{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 34:return i=e.sent,e.next=37,i.json();case 37:if(!e.sent.success){e.next=54;break}return e.prev=39,e.next=42,fetch("".concat(o,"/book"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(Y.a)({facility:r.name},d)),credentials:"include"});case 42:return l=e.sent,e.next=45,l.json();case 45:e.sent.success?(ae(ne-1),t("Your slot has been booked!","success")):t("Slot has been fully booked.","error"),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(39),console.log(e.t1);case 52:e.next=55;break;case 54:t("You have insufficient credits left for this week.","error");case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(29),console.log(e.t2);case 60:return e.next=62,be();case 62:return e.next=64,a();case 64:return e.next=66,me();case 66:ie(!1);case 67:case"end":return e.stop()}}),e,null,[[4,24],[29,57],[39,49]])})));return function(t){return e.apply(this,arguments)}}(),[R,t,r.name,d,ne]),fe=function(){return G(!1)},Oe=[],ge=0;ge<3;ge++)Oe[ge]=Object(h.jsx)(oe,{facility:r.name,assignedDate:Object(L.default)(ue,ge),hours:(de+ge)%7===0||(de+ge)%7===6?r.weekendHours:r.weekdayHours,handleChange:je,selectedSlot:d,bookedSlots:f,slotCount:F},Object(L.default)(ue,ge).toLocaleDateString());return Object(h.jsxs)("div",{className:n.root,children:[Object(h.jsx)(Ne,{handleAlert:t,bookedSlots:T}),Object(h.jsxs)(_.a,{className:n.paper,children:[Object(h.jsx)(g.a,{variant:"h4",align:"center",className:n.header,children:"Book a Facility"}),Object(h.jsx)(O.a,{className:n.box,children:Object(h.jsxs)(x.a,{variant:"outlined",className:n.formControl,children:[Object(h.jsx)(y.a,{id:"facility-label",children:"Select Facility"}),Object(h.jsx)(v.a,{value:r.name,labelId:"facility-label",id:"facility",onChange:function(e){i(Ee.filter((function(t){return t.name===e.target.value}))[0]),b({})},label:"Select Facility",children:Ee.map((function(e,t){return Object(h.jsx)(k.a,{value:e.name,children:e.name},t)}))})]})}),!re&&Object(h.jsx)(O.a,{display:"flex",mt:2,justifyContent:"center",children:Object(h.jsx)(z.a,{label:Object(h.jsxs)(g.a,{children:[Object(h.jsx)("strong",{children:"Remaining credits this week:"})," ",ne]})})}),re?Object(h.jsxs)(O.a,{display:"flex",flexDirection:"column",alignItems:"center",mt:3,children:[Object(h.jsx)(J.a,{className:n.circularProgress}),Object(h.jsx)(g.a,{variant:"h5",children:"Loading bookings page..."})]}):Object(h.jsxs)("form",{onSubmit:function(e){e.preventDefault(),G(!0)},children:[Oe,0!==Object.keys(d).length&&Object(h.jsx)(O.a,{display:"flex",justifyContent:"center",children:Object(h.jsx)("input",{type:"submit",value:R,className:n.button})})]})]}),Object(h.jsxs)($.a,{open:U,onClose:fe,children:[Object(h.jsx)(Q.a,{children:"Book"===R?"Book selected slot?":"Cancel selected slot?"}),Object(h.jsxs)(X.a,{children:[Object(h.jsx)(Z.a,{children:"Facility: ".concat(r.name)}),Object(h.jsx)(Z.a,{children:"Date: ".concat(d.date&&d.date.toDateString())}),Object(h.jsx)(Z.a,{children:"Hour: ".concat(d.date&&d.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""))})]}),Object(h.jsxs)(ee.a,{children:[Object(h.jsx)(D.a,{onClick:fe,color:"primary",children:"No"}),Object(h.jsx)(D.a,{onClick:function(e){fe(),pe(e)},color:"primary",children:"Yes"})]})]})]})},Fe=Object(N.a)((function(e){return{circularProgress:{marginBottom:e.spacing(1.5),color:G.a[200]}}})),Ae=function(e){var t=e.handleAlert,n=e.loggedIn,a=e.loading,c=Fe();return Object(h.jsx)("div",{className:c.root,children:a?Object(h.jsx)(O.a,{display:"flex",flexDirection:"column",alignItems:"center",mt:3,children:Object(h.jsx)(J.a,{className:c.circularProgress})}):n?Object(h.jsx)(O.a,{mt:2,children:Object(h.jsx)(Ie,{handleAlert:t})}):Object(h.jsx)(U,{})})},Be=n(499),He=n(496),Re=Object(N.a)((function(e){return{root:{maxWidth:"350px",display:"flex",flexDirection:"column",border:"1px solid grey",borderRadius:5,padding:e.spacing(4),margin:"0 auto",textAlign:"center",marginTop:e.spacing(8)},formControl:{display:"flex",marginBottom:e.spacing(4)},helperText:{textAlign:"center",marginTop:e.spacing(2)},button:{backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[800]}},link:{color:"#EF7C00",textDecoration:"none"}}})),Pe=function(e){var t=e.handleAlert,n=(e.loggedIn,e.setLoggedIn),c=Re(),s=Object(a.useState)(""),r=Object(o.a)(s,2),i=r[0],l=r[1],u=Object(a.useState)(""),b=Object(o.a)(u,2),m=b[0],p=b[1],f=Object(j.f)(),v=function(e){e.preventDefault();var a="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","login");fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:m}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success&&(t("Successfully logged in!","success"),n(!0),f.push("/"))})).catch((function(e){t("Failed to login, please try again! :(","error"),l(""),p("")}))};return Object(h.jsxs)(O.a,{className:c.root,children:[Object(h.jsx)(g.a,{variant:"h6",children:"Login"}),Object(h.jsxs)("form",{onSubmit:v,children:[Object(h.jsxs)(x.a,{className:c.formControl,children:[Object(h.jsx)(y.a,{htmlFor:"email",children:"Email"}),Object(h.jsx)(He.a,{id:"email",type:"email",name:"email",value:i,onChange:function(e){return l(e.target.value)},required:!0})]}),Object(h.jsxs)(x.a,{className:c.formControl,children:[Object(h.jsx)(y.a,{htmlFor:"password",children:"Password"}),Object(h.jsx)(He.a,{id:"password",type:"password",name:"password",value:m,onChange:function(e){return p(e.target.value)},required:!0})]}),Object(h.jsx)(D.a,{variant:"contained",type:"submit",onSubmit:v,disableElevation:!0,className:c.button,children:"Login"})]}),Object(h.jsxs)(Be.a,{className:c.helperText,children:["New user? Click"," ",Object(h.jsx)(d.b,{to:"/register",className:c.link,children:"here"})," ","to register now!"]})]})},We=n(574),Me=n(564),Ue=Object(N.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1},titleLink:{textDecoration:"none",color:"white"},link:{textDecoration:"none",color:"white"},appBar:{backgroundColor:u.a[700]}}})),Je=function(e){var t=e.loggedIn,n=e.setLoggedIn,c=Ue();return Object(h.jsx)("nav",{className:c.root,children:Object(h.jsx)(We.a,{position:"static",className:c.appBar,children:Object(h.jsxs)(Me.a,{children:[Object(h.jsx)(g.a,{variant:"h6",className:c.title,children:Object(h.jsx)(d.b,{to:"/",className:c.titleLink,children:"NUSFitness"})}),t?Object(h.jsxs)(a.Fragment,{children:[Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/",className:c.link,children:"Home"})}),Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/dashboard",className:c.link,children:"Dashboard"})}),Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/profile",className:c.link,children:"Profile"})}),Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/",onClick:function(e){e.preventDefault();var t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","logout");fetch(t,{credentials:"include"}).catch((function(e){return console.log(e)})),n(!1)},className:c.link,children:"Logout"})})]}):Object(h.jsxs)(a.Fragment,{children:[Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/login",className:c.link,children:"Login"})}),Object(h.jsx)(D.a,{children:Object(h.jsx)(d.b,{to:"/register",className:c.link,children:"Register"})})]})]})})})},Ge=Object(N.a)((function(e){return{root:{maxWidth:"350px",display:"flex",flexDirection:"column",border:"1px solid grey",borderRadius:5,padding:e.spacing(4),margin:"0 auto",textAlign:"center",marginTop:e.spacing(8)},formControl:{display:"flex",marginBottom:e.spacing(4)},helperText:{textAlign:"center",marginTop:e.spacing(2)},button:{backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[800]}},link:{color:"#EF7C00",textDecoration:"none"}}})),Ye=function(e){var t=e.handleAlert,n=(e.loggedIn,e.setLoggedIn),c=Ge(),s=Object(a.useState)(""),r=Object(o.a)(s,2),i=r[0],l=r[1],u=Object(a.useState)(""),b=Object(o.a)(u,2),m=b[0],p=b[1],f=Object(j.f)(),v=function(e){if(e.preventDefault(),!i.includes("u.nus.edu"))return t("Please enter a valid NUS email","error"),l(""),void p("");var a="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","register");fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:m}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e._id?(t("Successfully registered! Head to the profile section to sync with telegram!","info",7e3),n(!0),f.push("/")):(t("Failed to register, please try again! :(","error"),l(""),p(""))}))};return Object(h.jsxs)(O.a,{className:c.root,children:[Object(h.jsx)(g.a,{variant:"h6",children:"Register"}),Object(h.jsxs)("form",{onSubmit:v,children:[Object(h.jsxs)(x.a,{className:c.formControl,children:[Object(h.jsx)(y.a,{htmlFor:"email",children:"Email"}),Object(h.jsx)(He.a,{className:c.input,id:"email",type:"email",name:"email",value:i,onChange:function(e){return l(e.target.value)},required:!0})]}),Object(h.jsxs)(x.a,{className:c.formControl,children:[Object(h.jsx)(y.a,{htmlFor:"password",children:"Password"}),Object(h.jsx)(He.a,{id:"password",type:"password",name:"password",value:m,onChange:function(e){return p(e.target.value)},required:!0})]}),Object(h.jsx)(D.a,{variant:"contained",type:"submit",onSubmit:v,disableElevation:!0,className:c.button,children:"Register"})]}),Object(h.jsxs)(Be.a,{className:c.helperText,children:["Already a user? Click"," ",Object(h.jsx)(d.b,{to:"/login",className:c.link,children:"here"})," ","to login now!"]})]})},Ke=n(590),qe=n(575),Ve=n(561),_e=n(565),ze=n(560),$e=n(563),Qe=n(562),Xe=n(329),Ze=n.n(Xe),et=function(){return Object(h.jsx)(Ze.a,{dataOnauth:function(e){var t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","telegram/login");fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.first_name,chatId:e.id}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success||console.log(e)}))},botName:"NUSFitness_Bot"})},tt=Object(N.a)((function(e){return{root:{padding:e.spacing(4)},container:Object(f.a)({},e.breakpoints.down("sm"),{flexDirection:"column",alignItems:"inherit"}),tableContainer:{width:"inherit"},circularProgress:{margin:"0 auto",color:G.a[200]},profileBox:{border:"1px solid grey",borderRadius:12},avatar:{width:200,height:200,marginTop:e.spacing(2),marginBottom:e.spacing(1)},info:{marginTop:e.spacing(1),marginBottom:e.spacing(2)},chip:{marginTop:e.spacing(2)},telegramLogin:Object(f.a)({marginTop:e.spacing(2)},e.breakpoints.down("sm"),{marginBottom:e.spacing(2)})}})),nt=function(e){e.handleAlert;var t=e.loggedIn,n=tt(),c=Object(a.useState)([]),s=Object(o.a)(c,2),r=s[0],i=s[1],l=Object(a.useState)(),u=Object(o.a)(l,2),d=u[0],j=u[1],b=Object(a.useState)(),m=Object(o.a)(b,2),p=m[0],f=m[1],x=Object(a.useState)(),y=Object(o.a)(x,2),v=y[0],k=y[1],w=Object(a.useState)({}),S=Object(o.a)(w,2),C=S[0],T=S[1],D=Object(a.useState)(),N=Object(o.a)(D,2),L=N[0],E=N[1],I=Object(a.useMemo)((function(){return d||p||v}),[d,p,v]);return Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots");j(!0),fetch(e,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){i(e.map((function(e){return{facility:e.facility,date:new Date(e.date)}}))),j(!1)})).catch((function(e){j(!1),console.log(e)}))}),[]),Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","profile");k(!0),fetch(e,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){T(e),k(!1)})).catch((function(e){k(!1),console.log(e)}))}),[]),Object(a.useEffect)((function(){function e(){return(e=Object(V.a)(q.a.mark((function e(){var t,n,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","creditsLeft"),f(!0),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,E(a.credits),f(!1);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(h.jsx)("div",{className:n.root,children:t?I?Object(h.jsx)(O.a,{display:"flex",mt:1.5,justifyContent:"center",children:Object(h.jsx)(J.a,{className:n.circularProgress})}):Object(h.jsxs)(O.a,{display:"flex",justifyContent:"center",className:n.container,alignItems:"flex-start",children:[Object(h.jsxs)(O.a,{ml:2,mr:2,flex:3,display:"flex",flexDirection:"column",children:[Object(h.jsxs)(O.a,{display:"flex",alignItems:"center",flexDirection:"column",className:n.profileBox,children:[Object(h.jsx)(Ke.a,{src:"https://robohash.org/".concat(C.email,"?set=set5"),className:n.avatar}),Object(h.jsx)(g.a,{variant:"h6",children:C.email}),Object(h.jsx)(O.a,{className:n.info,display:"flex",flexDirection:"column",alignItems:"center",children:Object(h.jsxs)(g.a,{children:[Object(h.jsx)("strong",{children:"Joined:"})," ",new Date(C.joined).toLocaleDateString()]})})]}),Object(h.jsx)(z.a,{className:n.chip,label:Object(h.jsxs)(g.a,{children:[Object(h.jsx)("strong",{children:"Remaining credits this week:"})," ",L]})}),Object(h.jsx)(O.a,{display:"flex",justifyContent:"center",className:n.telegramLogin,children:Object(h.jsx)(et,{})})]}),Object(h.jsxs)(O.a,{ml:2,mr:2,display:"flex",flexDirection:"column",flex:7,children:[Object(h.jsx)(O.a,{display:"flex",justifyContent:"center",mb:1,children:Object(h.jsx)(g.a,{variant:"h4",children:"My Bookings"})}),Object(h.jsx)(qe.a,{className:n.tableContainer,component:_.a,children:Object(h.jsxs)(Ve.a,{children:[Object(h.jsx)(_e.a,{children:Object(h.jsxs)(ze.a,{children:[Object(h.jsx)($e.a,{children:"Facility"}),Object(h.jsx)($e.a,{align:"right",children:"Date"}),Object(h.jsx)($e.a,{align:"right",children:"Time"})]})}),Object(h.jsx)(Qe.a,{children:!I&&r.map((function(e){return Object(h.jsxs)(ze.a,{children:[Object(h.jsx)($e.a,{component:"th",scope:"row",children:e.facility}),Object(h.jsx)($e.a,{align:"right",children:e.date.toDateString()}),Object(h.jsx)($e.a,{align:"right",children:e.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")})]},e.facility)}))})]})}),!r.length&&Object(h.jsx)(O.a,{display:"flex",mt:1.5,justifyContent:"center",children:Object(h.jsx)("span",{children:"No bookings found."})})]})]}):Object(h.jsx)(U,{})})},at=Object(i.a)({palette:{primary:{main:u.a[700]}},overrides:{MuiButton:{contained:{backgroundColor:"#337ab7","&:hover":{backgroundColor:"#286090"},color:"white"}},MuiFormLabel:{root:{"&$focused":{color:"#337ab7"}}},MuiInput:{underline:{"&:after":{borderBottom:"2px solid #337ab7"}}}}}),ct=function(){var e=Object(a.useState)(null),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),r=Object(o.a)(s,2),i=r[0],u=r[1],b=Object(a.useState)(!1),p=Object(o.a)(b,2),f=p[0],O=p[1],g=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;c({msg:e,type:t}),setTimeout((function(){c(null)}),n)};return Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","isLoggedIn");O(!0),fetch(e,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){u(e.authenticated),O(!1)})).catch((function(e){console.log(e),u(!1),O(!1)}))}),[]),Object(h.jsx)(l.a,{theme:at,children:Object(h.jsx)(d.a,{basename:"/nusfitness",children:Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(Je,{loggedIn:i,setLoggedIn:u}),Object(h.jsx)(m,{alert:n}),Object(h.jsxs)(j.c,{children:[Object(h.jsx)(j.a,{exact:!0,path:"/dashboard",children:Object(h.jsx)(U,{})}),Object(h.jsx)(j.a,{exact:!0,path:"/profile",children:Object(h.jsx)(nt,{handleAlert:g,loggedIn:i})}),Object(h.jsx)(j.a,{exact:!0,path:"/register",children:Object(h.jsx)(Ye,{handleAlert:g,loggedIn:i,setLoggedIn:u})}),Object(h.jsx)(j.a,{exact:!0,path:"/login",children:Object(h.jsx)(Pe,{handleAlert:g,loggedIn:i,setLoggedIn:u})}),Object(h.jsx)(j.a,{exact:!0,path:"/",children:Object(h.jsx)(Ae,{handleAlert:g,loggedIn:i,setLoggedIn:u,loading:f})})]})]})})})};r.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(ct,{})}),document.getElementById("root"))}},[[490,1,2]]]);
//# sourceMappingURL=main.28610ba6.chunk.js.map