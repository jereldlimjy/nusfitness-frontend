(this.webpackJsonpnusfitness=this.webpackJsonpnusfitness||[]).push([[0],{357:function(e,t,n){},358:function(e,t,n){},490:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(25),s=n.n(o),i=(n(357),n(23)),r=n(330),l=n(576),u=n(559),d=n(45),j=n(33),h=(n(358),n(582)),b=n(4),m=function(e){var t=e.alert;return null!==t&&Object(b.jsx)(h.a,{severity:t.type,children:t.msg})},f=n(146),p=n(84),O=n(579),g=n(245),x=n(495),y=n(503),v=n(502),k=n(587),w=n(552),S=n(553),C=n(584),T=n(554),D=n(555),N=n(549),L=n(106),E=(n(364),n(365),n(307)),I=function(e){var t=e.selectedDates,n=e.setSelectedDates;return Object(b.jsx)(E.DateRange,{onChange:function(e){return n([e.selection])},showSelectionPreview:!0,moveRangeOnFirstSelection:!1,months:1,maxDate:new Date,ranges:t,direction:"horizontal"})},F=n(581),A=n(586),B=n(583),H=n(585),R=n(593),P=n(577),W=function(e){var t=e.setTime,n=e.data,a=e.chartTitle,c=[t(8,0),t(9,0),t(10,0),t(11,0),t(12,0),t(13,0),t(14,0),t(15,0),t(16,0),t(17,0),t(18,0),t(19,0),t(20,0),t(21,0)];return Object(b.jsxs)(F.a,{theme:A.a.material,containerComponent:Object(b.jsx)(B.a,{labels:function(e){return"Time: ".concat(e.datum.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),", Count: ").concat(e.datum.count)},radius:25}),minDomain:{x:t(7,0),y:0},maxDomain:{x:t(22,0),y:40},height:250,width:900,padding:{top:0,right:25,bottom:0,left:50},children:[Object(b.jsx)(H.a,{text:a,x:450,y:-30,textAnchor:"middle",style:{fontSize:18}}),Object(b.jsx)(R.a,{label:"Time",tickValues:c,tickFormat:function(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")},axisLabelComponent:Object(b.jsx)(H.a,{dy:30})}),Object(b.jsx)(R.a,{dependentAxis:!0,label:"Capacity",axisLabelComponent:Object(b.jsx)(H.a,{dy:-30})}),Object(b.jsx)(P.a,{data:n,x:"date",y:"count",scale:{x:"time",y:"linear"}})]})},M=Object(N.a)((function(e){var t;return{root:(t={},Object(p.a)(t,e.breakpoints.down("xs"),{flexDirection:"column"}),Object(p.a)(t,"padding",e.spacing(2)),Object(p.a)(t,"& .MuiCheckbox-colorPrimary.Mui-checked",{color:"rgb(61, 145, 255)"}),t),formControl:{marginTop:e.spacing(1),width:"100%"},selectButton:{backgroundColor:"rgb(61, 145, 255)"}}})),U=function(){var e=M(),t=["Kent Ridge Swimming Pool","University Town Swimming Pool","Kent Ridge Gym","University Sports Centre Gym","University Town Gym","Wellness Outreach Gym"],n=function(e,t){var n=new Date;return n.setHours(e,t,0,0),n},c=Object(a.useState)(t[0]),o=Object(i.a)(c,2),s=o[0],r=o[1],l=Object(a.useState)([]),u=Object(i.a)(l,2),d=u[0],j=u[1],h=Object(a.useState)([{startDate:n(0,0),endDate:n(0,0),key:"selection"}]),m=Object(i.a)(h,2),p=m[0],N=m[1],E=Object(a.useState)([1,2,3,4,5,6,7]),F=Object(i.a)(E,2),A=F[0],B=F[1],H=Object(a.useState)(""),R=Object(i.a)(H,2),P=R[0],U=R[1],J=function(e){var t=e.target;t.checked?B([].concat(Object(f.a)(A),[parseInt(t.value)])):B(A.filter((function(e){return e!==parseInt(t.value)})))},G=function(e){switch(e.target.innerText){case"SELECT ALL":B([1,2,3,4,5,6,7]);break;case"REMOVE ALL":B([]);break;case"WEEKDAYS":B([2,3,4,5,6]);break;case"WEEKENDS":B([1,7])}};return Object(a.useEffect)((function(){var e=Object(i.a)(p,1)[0],n=e.startDate,a=Object(L.default)(e.endDate,1),c="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","traffic");fetch(c,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:t.indexOf(s),date:{$gte:n,$lte:a},day:A}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){return j(e.map((function(e){return{date:new Date(e.date),count:e.count}})))}))}),[s,p,A]),Object(a.useEffect)((function(){U("".concat(s,"\n").concat(p[0].startDate.toDateString()," to ").concat(p[0].endDate.toDateString()," "))}),[s,p,A]),Object(b.jsxs)(O.a,{display:"flex",className:e.root,children:[Object(b.jsxs)(O.a,{display:"flex",flex:"1 1 0",flexDirection:"column",maxWidth:"370px",className:e.root,children:[Object(b.jsx)(g.a,{variant:"h4",children:"Filters"}),Object(b.jsxs)(O.a,{width:"100%",mt:2,mb:2,children:[Object(b.jsx)(g.a,{variant:"h6",children:"Facility"}),Object(b.jsxs)(x.a,{variant:"outlined",className:e.formControl,children:[Object(b.jsx)(y.a,{id:"facility-label",children:"Select Facility"}),Object(b.jsx)(v.a,{value:s,labelId:"facility-label",id:"facility",onChange:function(e){r(e.target.value)},label:"Select Facility",children:t.map((function(e){return Object(b.jsx)(k.a,{value:e,children:e},e)}))})]})]}),Object(b.jsxs)(O.a,{mt:1,children:[Object(b.jsx)(g.a,{variant:"h6",children:"Date Range"}),Object(b.jsx)(I,{selectedDates:p,setSelectedDates:N})]}),Object(b.jsxs)(x.a,{children:[Object(b.jsx)(g.a,{variant:"h6",children:"Days of week"}),Object(b.jsx)(w.a,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((function(e,t){return Object(b.jsx)(S.a,{control:Object(b.jsx)(C.a,{value:t+1,checked:A.includes(t+1),onChange:J,id:e,color:"primary"},e+e),label:e})}))})]}),Object(b.jsx)(T.a,{container:!0,spacing:1,justify:"flex-start",children:["SELECT ALL","REMOVE ALL","WEEKDAYS","WEEKENDS"].map((function(t){return Object(b.jsx)(T.a,{item:!0,xs:6,children:Object(b.jsx)(D.a,{variant:"contained",fullWidth:!0,onClick:G,className:e.selectButton,children:t})})}))})]}),Object(b.jsx)(O.a,{flex:"3 0 0",children:Object(b.jsx)(W,{setTime:n,data:d,chartTitle:P})})]})},J=n(42),G=n(46),Y=n.n(G),K=n(100),q=n(204),V=n(588),_=n(570),z=n(567),$=n(571),Q=n(568),X=n(573),Z=n(569),ee=n(556),te=n(558),ne=n(198),ae=n(557),ce=Object(N.a)((function(e){return{root:{margin:e.spacing(.5)},slot:{display:"none","&[disabled] ~ label":{color:"rgb(170, 170, 170)"},"&[booked='true'] ~ label":{backgroundColor:ee.a[200]},"&[booked='true']:checked ~ label":{backgroundColor:ne.a[400]},"&:checked ~ label":{backgroundColor:ne.a[400]}},slotLabel:{display:"inline-block",boxSizing:"border-box",margin:0,padding:"5px 20px",width:"100%",cursor:"pointer"}}})),oe=function(e){var t=e.date,n=e.handleChange,a=e.checked,c=e.booked,o=e.slotsLeft,s=ce(),i=Object(ae.a)(t,1),r=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),l=(new Date).getTime();return Object(b.jsxs)(te.a,{className:s.root,children:[Object(b.jsx)("input",{type:"checkbox",className:s.slot,id:t,date:t,onChange:n,checked:a,disabled:i<=l,booked:c.toString()}),Object(b.jsx)("label",{className:s.slotLabel,htmlFor:t,children:Object(b.jsx)("strong",{children:r})}),Object(b.jsx)("label",{className:s.slotLabel,htmlFor:t,children:"".concat(o," Left")})]})},se=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},box:{display:"flex",flexDirection:"row",flexWrap:"wrap"}}})),ie=function(e){e.facility;var t=e.assignedDate,n=e.hours,a=e.handleChange,c=e.selectedSlot,o=e.bookedSlots,s=e.slotCount,i=se();return Object(b.jsxs)("div",{className:i.root,children:[Object(b.jsx)(g.a,{variant:"h5",children:t.toDateString()}),Object(b.jsx)(O.a,{className:i.box,children:n.map((function(e){var n=parseInt(e.slice(0,2)),i=parseInt(e.slice(2,4)),r=new Date(t);r.setHours(n,i,0,0);var l=40,u=s.find((function(e){return e.date.getTime()===r.getTime()}));return u&&(l=40-u.count),Object(b.jsx)(oe,{date:r,handleChange:a,checked:c.date&&c.date.getTime()===r.getTime(),booked:o.filter((function(e){return e.date.getTime()===r.getTime()})).length>0,slotsLeft:l},r.toLocaleString())}))})]})},re=n(244),le=n(74),ue=n(589),de=n(566),je=n(199),he=n(197),be=n(572),me=n(202),fe=n(331),pe=n(327),Oe=n.n(pe),ge={"Design Lecture":"DLEC",Laboratory:"LAB",Lecture:"LEC","Packaged Lecture":"PLEC","Packaged Tutorial":"PTUT",Recitation:"REC","Sectional Teaching":"SEC","Seminar-Style Module Class":"SEM",Tutorial:"TUT","Tutorial Type 2":"TUT2","Tutorial Type 3":"TUT3",Workshop:"WS"},xe=Object(me.invert)(ge),ye={"Semester 1":1,"Semester 2":2,"Special Term I":3,"Special Term II":4},ve={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},ke=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},container:{width:"100%",height:"100%",padding:0},title:{fontWeight:"600"},timeTableCell:{height:"66px"},timeLabel:{height:"66px",lineHeight:"64px","&:first-child":{height:"33px"},"&:last-child":{height:"33px"}},inputContainer:{display:"flex",marginBottom:e.spacing(2)},timetableButton:{marginRight:e.spacing(2),backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[700]}},lessonsButton:{marginRight:e.spacing(2),backgroundColor:ee.a[400],"&:hover":{backgroundColor:ee.a[500]}},inputField:{marginRight:e.spacing(2)},select:{minWidth:200,marginRight:e.spacing(2)}}})),we=function(e){var t=e.style,n=Object(re.a)(e,["style"]),a=n.data.isLesson?je.a[400]:he.a[400];return Object(b.jsx)(le.a.Appointment,Object(J.a)(Object(J.a)({},n),{},{style:Object(J.a)(Object(J.a)({},t),{},{backgroundColor:a})}))},Se=function(e){var t=e.data,n=Object(re.a)(e,["data"]),a=ke();return Object(b.jsx)(le.a.AppointmentContent,Object(J.a)(Object(J.a)({},n),{},{data:t,children:Object(b.jsxs)("div",{className:a.container,children:[Object(b.jsx)("div",{className:a.title,children:t.title}),Object(b.jsx)("div",{children:t.lessonType}),Object(b.jsx)("div",{children:t.location})]})}))},Ce=function(e){var t=ke();return Object(b.jsx)(le.d.TimeTableCell,Object(J.a)(Object(J.a)({},e),{},{className:t.timeTableCell}))},Te=function(e){var t=ke();return Object(b.jsx)(le.d.TimeScaleLabel,Object(J.a)(Object(J.a)({},e),{},{formatDate:function(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")},className:t.timeLabel}))},De=function(e){var t=ke();return Object(b.jsx)(le.d.TimeScaleTickCell,Object(J.a)(Object(J.a)({},e),{},{className:t.timeTableCell}))},Ne=function(e){var t=e.bookedSlots,n=Object(a.useState)(!1),c=Object(i.a)(n,2),o=c[0],s=c[1],r=Object(a.useState)(!0),l=Object(i.a)(r,2),u=l[0],d=l[1],j=Object(a.useState)(0),h=Object(i.a)(j,2),m=h[0],p=h[1],g=Object(a.useState)("https://nusmods.com/timetable/st-i/share?TBA2101=TUT:2,LEC:1"),x=Object(i.a)(g,2),y=x[0],v=x[1],w=Object(a.useState)(!1),S=Object(i.a)(w,2),C=S[0],T=S[1],N=Object(a.useState)([]),E=Object(i.a)(N,2),I=E[0],F=E[1],A=ke(),B=function(){var e=y.match(/sem-[1|2]/),t=y.match(/st-i{2}\/|st-i\//);if(e||t){if(e)return T(!1),parseInt(e[0].slice(4,5));if(t)return T(!1),5===t[0].length?3:4}else T(!0)},H=function(){var e=y.match(/\?\S*/);if(e){T(!1);var t=Oe.a.parse(e[0]);return Object(me.mapValues)(t,R)}T(!0)},R=function(e){var t={};return e?(Object(me.castArray)(e).forEach((function(e){e.split(",").forEach((function(e){var n=e.split(":"),a=Object(i.a)(n,2),c=a[0],o=a[1],s=xe[c];s&&(t[s]=o)}))})),t):t},P=function(e){var t=(e=new Date(e)).getDay(),n=e.getDate()-t;return new Date(e.setDate(n))},W=function(){var e=Object(K.a)(Y.a.mark((function e(t,n){var a,c,o,s,r;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=P(new Date),c=[],o=Y.a.mark((function e(){var n,o,l;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(i.a)(r[s],2),o=n[0],l=n[1],e.next=3,fetch("https://api.nusmods.com/v2/2021-2022/modules/".concat(o,".json"),{method:"get"}).then((function(e){return e.json()})).then((function(e){var n=e.semesterData.filter((function(e){return e.semester===t})),s=Object(i.a)(n,1)[0];if(s){var r=Object.keys(l).flatMap((function(e){return s.timetable.filter((function(t){return t.classNo===l[e]&&t.lessonType===e}))}));if(!u){var d=fe.a.academicCalendar.getAcadWeekInfo(new Date),j=ye[d.sem],h=d.num;r=r.filter((function(e){return j===t&&e.weeks.includes(h)}))}var b=r.map((function(e){var t=o,n=parseInt(e.startTime.slice(0,2)),c=parseInt(e.startTime.slice(2,4)),s=parseInt(e.endTime.slice(0,2)),i=parseInt(e.endTime.slice(2,4)),r=Object(L.default)(a,ve[e.day]),l=Object(L.default)(a,ve[e.day]);r.setHours(n,c,0,0),l.setHours(s,i,0,0);return{title:t,startDate:r,endDate:l,lessonType:"".concat(ge[e.lessonType]," [").concat(e.classNo,"]"),location:e.venue,isLesson:!0}}));c=c.concat(b)}else T(!0)}));case 3:case"end":return e.stop()}}),e)})),s=0,r=Object.entries(n);case 4:if(!(s<r.length)){e.next=9;break}return e.delegateYield(o(),"t0",6);case 6:s++,e.next=4;break;case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){(function(){var e=Object(K.a)(Y.a.mark((function e(){var n,a,c,o;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=B()){e.next=3;break}return e.abrupt("return");case 3:if(a=H()){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,W(n,a);case 8:return c=e.sent,e.next=11,t=t.map((function(e){var t=new Date(e.date),n=0===t.getMinutes()?Object(ae.a)(t,1):Object(be.a)(Object(ae.a)(t,1),30);return{title:"Facility Booking",startDate:t,endDate:n,location:e.facility,isLesson:!1}}));case 11:o=e.sent,F([].concat(Object(f.a)(c),Object(f.a)(o)));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[y,u,t]);return Object(b.jsxs)(O.a,{className:A.root,children:[Object(b.jsxs)(O.a,{className:A.inputContainer,children:[Object(b.jsx)(D.a,{onClick:function(){s(!o)},variant:"contained",className:A.timetableButton,children:o?"Hide Timetable":"Show Timetable"}),o&&Object(b.jsx)(ue.a,{title:u?"Only show lessons which occur during the current academic week":"Show lessons regardless of academic week",children:Object(b.jsx)(D.a,{onClick:function(){d(!u)},variant:"contained",color:"secondary",className:A.lessonsButton,children:u?"Hide Lessons":"Always Show Lessons"})}),o&&Object(b.jsxs)(de.a,{select:!0,label:"First Day of Week",variant:"outlined",className:A.select,onChange:function(e){return p(e.target.value)},value:m,children:[Object(b.jsx)(k.a,{value:0,children:"Sunday"}),Object(b.jsx)(k.a,{value:1,children:"Monday"})]}),o&&Object(b.jsx)(de.a,{error:C,label:C?"Error":"NUSMods Share Link",helperText:C?"Invalid Link":"",value:y,variant:"outlined",onChange:function(e){return v(e.target.value)},className:A.inputField})]}),o&&Object(b.jsx)(q.a,{children:Object(b.jsxs)(le.c,{firstDayOfWeek:m,data:I,children:[Object(b.jsx)(le.d,{startDayHour:7,endDayHour:22,cellDuration:60,timeTableCellComponent:Ce,timeScaleLabelComponent:Te,timeScaleTickCellComponent:De}),Object(b.jsx)(le.a,{appointmentComponent:we,appointmentContentComponent:Se}),Object(b.jsx)(le.b,{})]})})]})},Le=Object(N.a)((function(e){return{root:{padding:e.spacing(2)},box:{display:"flex",justifyContent:"center"},formControl:{margin:e.spacing(1),width:"50%"},button:{padding:e.spacing(1.5,2),cursor:"pointer",border:0,borderRadius:5,backgroundColor:u.a[600],color:"white","&:hover":{backgroundColor:u.a[800]}},circularProgress:{marginBottom:e.spacing(1.5),color:ee.a[200]},paper:{marginLeft:e.spacing(2),marginRight:e.spacing(2),paddingBottom:e.spacing(2)},header:{paddingTop:e.spacing(2)}}})),Ee=[{name:"Kent Ridge Swimming Pool",weekdayHours:["0730","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"University Town Swimming Pool",weekdayHours:["0730","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"Kent Ridge Gym",weekdayHours:["1100","1200","1300","1400","1500","1600","1700","1800","1900"],weekendHours:[]},{name:"University Sports Centre Gym",weekdayHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000"],weekendHours:["0900","1000","1100","1200","1300","1400","1500","1600","1700","1800"]},{name:"University Town Gym",weekdayHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"],weekendHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"]},{name:"Wellness Outreach Gym",weekdayHours:["0700","0800","0900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100"],weekendHours:[]}],Ie=function(e){var t=e.handleAlert,n=Le(),c=Object(a.useState)(Ee[0]),o=Object(i.a)(c,2),s=o[0],r=o[1],l=Object(a.useState)({}),u=Object(i.a)(l,2),d=u[0],h=u[1],m=Object(a.useState)([]),f=Object(i.a)(m,2),p=f[0],w=f[1],S=Object(a.useState)([]),C=Object(i.a)(S,2),T=C[0],N=C[1],E=Object(a.useState)([]),I=Object(i.a)(E,2),F=I[0],A=I[1],B=Object(a.useState)("Book"),H=Object(i.a)(B,2),R=H[0],P=H[1],W=Object(a.useState)(!1),M=Object(i.a)(W,2),U=M[0],G=M[1],ee=Object(a.useState)(),te=Object(i.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),oe=Object(i.a)(ce,2),se=oe[0],re=oe[1],le=Object(j.f)(),ue=new Date,de=ue.getDay();console.log(le.location.state),Object(a.useEffect)((function(){function e(){return(e=Object(K.a)(Y.a.mark((function e(){var t,n,a;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","creditsLeft"),e.next=3,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 3:return n=e.sent,e.next=6,n.json();case 6:a=e.sent,ae(a.credits);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var je=function(e){var t=e.target;t.checked?h({date:new Date(t.attributes.date.value)}):h({});var n={date:new Date(t.attributes.date.value)};0!==Object.keys(n).length&&(p.find((function(e){return e.date.getTime()===n.date.getTime()}))?P("Cancel"):P("Book"))},he=Object(a.useCallback)(function(){var e=Object(K.a)(Y.a.mark((function e(n){var a,c,o;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),"Cancel"!==R){e.next=7;break}a="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","cancel"),re(!0),fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(J.a)({facility:s.name},d)),credentials:"include"}).then((function(e){return 401===e.status?(re(!1),t("You are unauthorised to cancel the slot. Please contact the website's administrator","error")):403===e.status?(re(!1),t("Unable to cancel slot because it is within the 2 hour cancellation window.","error")):404===e.status&&(re(!1),t("Slot cannot be found. Please contact the website's administrator","error")),h({}),e.json()})).then((function(e){e.success&&(re(!1),t("Your slot has been cancelled.","success"))})).catch((function(e){console.log(e)})),e.next=16;break;case 7:return c="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000":"https://salty-reaches-24995.herokuapp.com"),re(!0),e.next=11,fetch("".concat(c,"/updateCredits"),{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 11:return o=e.sent,e.next=14,o.json();case 14:e.sent.success?fetch("".concat(c,"/book"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(J.a)({facility:s.name},d)),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success?(re(!1),ae(ne-1),t("Your slot has been booked!","success")):(re(!1),t("Slot has been fully booked.","error")),h({})})).catch((function(e){console.log(e)})):(re(!1),t("You have insufficient credits left for this week.","error"));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[R,t,s.name,d,ne]);Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots");re(!0),fetch(e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:s.name}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){w(e.map((function(e){return{facility:e.facility,date:new Date(e.date)}}))),re(!1)})).catch((function(e){re(!1),console.log(e)}))}),[he,s.name]),Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots");fetch(e,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){return N(e.map((function(e){return{facility:e.facility,date:new Date(e.date)}})))})).catch((function(e){return console.log(e)}))}),[he]);var be=new Date(ue.getFullYear(),ue.getMonth(),ue.getDate());Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","slots");fetch(e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({facility:s.name,startDate:be,endDate:Object(L.default)(be,3)}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){return A(e.map((function(e){return{date:new Date(e._id),count:e.count}})))})).catch((function(e){return console.log(e)}))}),[s,d]);for(var me=function(){return G(!1)},fe=[],pe=0;pe<3;pe++)fe[pe]=Object(b.jsx)(ie,{facility:s.name,assignedDate:Object(L.default)(ue,pe),hours:(de+pe)%7===0||(de+pe)%7===6?s.weekendHours:s.weekdayHours,handleChange:je,selectedSlot:d,bookedSlots:p,slotCount:F},Object(L.default)(ue,pe).toLocaleDateString());return Object(b.jsxs)("div",{className:n.root,children:[Object(b.jsx)(Ne,{handleAlert:t,bookedSlots:T}),Object(b.jsxs)(q.a,{className:n.paper,children:[Object(b.jsx)(g.a,{variant:"h4",align:"center",className:n.header,children:"Book a Facility"}),Object(b.jsx)(O.a,{className:n.box,children:Object(b.jsxs)(x.a,{variant:"outlined",className:n.formControl,children:[Object(b.jsx)(y.a,{id:"facility-label",children:"Select Facility"}),Object(b.jsx)(v.a,{value:s.name,labelId:"facility-label",id:"facility",onChange:function(e){r(Ee.filter((function(t){return t.name===e.target.value}))[0]),h({})},label:"Select Facility",children:Ee.map((function(e,t){return Object(b.jsx)(k.a,{value:e.name,children:e.name},t)}))})]})}),!se&&Object(b.jsx)(O.a,{display:"flex",mt:2,justifyContent:"center",children:Object(b.jsx)(V.a,{label:Object(b.jsxs)(g.a,{children:[Object(b.jsx)("strong",{children:"Remaining credits this week:"})," ",ne]})})}),se?Object(b.jsxs)(O.a,{display:"flex",flexDirection:"column",alignItems:"center",mt:3,children:[Object(b.jsx)(_.a,{className:n.circularProgress}),Object(b.jsx)(g.a,{variant:"h5",children:"Processing Your Request..."})]}):Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault(),G(!0)},children:[fe,0!==Object.keys(d).length&&Object(b.jsx)(O.a,{display:"flex",justifyContent:"center",children:Object(b.jsx)("input",{type:"submit",value:R,className:n.button})})]})]}),Object(b.jsxs)(z.a,{open:U,onClose:me,children:[Object(b.jsx)($.a,{children:"Book"===R?"Book selected slot?":"Cancel selected slot?"}),Object(b.jsxs)(Q.a,{children:[Object(b.jsx)(X.a,{children:"Facility: ".concat(s.name)}),Object(b.jsx)(X.a,{children:"Date: ".concat(d.date&&d.date.toDateString())}),Object(b.jsx)(X.a,{children:"Hour: ".concat(d.date&&d.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""))})]}),Object(b.jsxs)(Z.a,{children:[Object(b.jsx)(D.a,{onClick:me,color:"primary",children:"No"}),Object(b.jsx)(D.a,{onClick:function(e){me(),he(e)},color:"primary",children:"Yes"})]})]})]})},Fe=Object(N.a)((function(e){return{root:{}}})),Ae=function(e){var t=e.handleAlert,n=e.loggedIn,a=(e.setLoggedIn,Fe());return Object(b.jsx)("div",{className:a.root,children:n?Object(b.jsx)(O.a,{mt:2,children:Object(b.jsx)(Ie,{handleAlert:t})}):Object(b.jsx)(U,{})})},Be=n(499),He=n(496),Re=Object(N.a)((function(e){return{root:{maxWidth:"350px",display:"flex",flexDirection:"column",border:"1px solid grey",borderRadius:5,padding:e.spacing(4),margin:"0 auto",textAlign:"center",marginTop:e.spacing(8)},formControl:{display:"flex",marginBottom:e.spacing(4)},helperText:{textAlign:"center",marginTop:e.spacing(2)},button:{backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[800]}},link:{color:"#EF7C00",textDecoration:"none"}}})),Pe=function(e){var t=e.handleAlert,n=(e.loggedIn,e.setLoggedIn),c=Re(),o=Object(a.useState)(""),s=Object(i.a)(o,2),r=s[0],l=s[1],u=Object(a.useState)(""),h=Object(i.a)(u,2),m=h[0],f=h[1],p=Object(j.f)(),v=function(e){e.preventDefault();var a="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","login");fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:m}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success&&(t("Successfully logged in!","success"),n(!0),p.push("/"))})).catch((function(e){t("Failed to login, please try again! :(","error"),l(""),f("")}))};return Object(b.jsxs)(O.a,{className:c.root,children:[Object(b.jsx)(g.a,{variant:"h6",children:"Login"}),Object(b.jsxs)("form",{onSubmit:v,children:[Object(b.jsxs)(x.a,{className:c.formControl,children:[Object(b.jsx)(y.a,{htmlFor:"email",children:"Email"}),Object(b.jsx)(He.a,{id:"email",type:"email",name:"email",value:r,onChange:function(e){return l(e.target.value)},required:!0})]}),Object(b.jsxs)(x.a,{className:c.formControl,children:[Object(b.jsx)(y.a,{htmlFor:"password",children:"Password"}),Object(b.jsx)(He.a,{id:"password",type:"password",name:"password",value:m,onChange:function(e){return f(e.target.value)},required:!0})]}),Object(b.jsx)(D.a,{variant:"contained",type:"submit",onSubmit:v,disableElevation:!0,className:c.button,children:"Login"})]}),Object(b.jsxs)(Be.a,{className:c.helperText,children:["New user? Click"," ",Object(b.jsx)(d.b,{to:"/register",className:c.link,children:"here"})," ","to register now!"]})]})},We=n(574),Me=n(564),Ue=Object(N.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1},titleLink:{textDecoration:"none",color:"white"},link:{textDecoration:"none",color:"white"},appBar:{backgroundColor:u.a[700]}}})),Je=function(e){var t=e.loggedIn,n=e.setLoggedIn,c=Ue();return Object(b.jsx)("nav",{className:c.root,children:Object(b.jsx)(We.a,{position:"static",className:c.appBar,children:Object(b.jsxs)(Me.a,{children:[Object(b.jsx)(g.a,{variant:"h6",className:c.title,children:Object(b.jsx)(d.b,{to:"/",className:c.titleLink,children:"NUSFitness"})}),t?Object(b.jsxs)(a.Fragment,{children:[Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/",className:c.link,children:"Home"})}),Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/dashboard",className:c.link,children:"Dashboard"})}),Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/profile",className:c.link,children:"Profile"})}),Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/",onClick:function(e){e.preventDefault();var t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","logout");fetch(t,{credentials:"include"}).catch((function(e){return console.log(e)})),n(!1)},className:c.link,children:"Logout"})})]}):Object(b.jsxs)(a.Fragment,{children:[Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/login",className:c.link,children:"Login"})}),Object(b.jsx)(D.a,{children:Object(b.jsx)(d.b,{to:"/register",className:c.link,children:"Register"})})]})]})})})},Ge=Object(N.a)((function(e){return{root:{maxWidth:"350px",display:"flex",flexDirection:"column",border:"1px solid grey",borderRadius:5,padding:e.spacing(4),margin:"0 auto",textAlign:"center",marginTop:e.spacing(8)},formControl:{display:"flex",marginBottom:e.spacing(4)},helperText:{textAlign:"center",marginTop:e.spacing(2)},button:{backgroundColor:u.a[600],"&:hover":{backgroundColor:u.a[800]}},link:{color:"#EF7C00",textDecoration:"none"}}})),Ye=function(e){var t=e.handleAlert,n=(e.loggedIn,e.setLoggedIn),c=Ge(),o=Object(a.useState)(""),s=Object(i.a)(o,2),r=s[0],l=s[1],u=Object(a.useState)(""),h=Object(i.a)(u,2),m=h[0],f=h[1],p=Object(j.f)(),v=function(e){if(e.preventDefault(),!r.includes("u.nus.edu"))return t("Please enter a valid NUS email","error"),l(""),void f("");var a="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","register");fetch(a,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:m}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e._id?(t("Successfully registered! Head to the profile section to sync with telegram!","info",7e3),n(!0),p.push("/")):(t("Failed to register, please try again! :(","error"),l(""),f(""))}))};return Object(b.jsxs)(O.a,{className:c.root,children:[Object(b.jsx)(g.a,{variant:"h6",children:"Register"}),Object(b.jsxs)("form",{onSubmit:v,children:[Object(b.jsxs)(x.a,{className:c.formControl,children:[Object(b.jsx)(y.a,{htmlFor:"email",children:"Email"}),Object(b.jsx)(He.a,{className:c.input,id:"email",type:"email",name:"email",value:r,onChange:function(e){return l(e.target.value)},required:!0})]}),Object(b.jsxs)(x.a,{className:c.formControl,children:[Object(b.jsx)(y.a,{htmlFor:"password",children:"Password"}),Object(b.jsx)(He.a,{id:"password",type:"password",name:"password",value:m,onChange:function(e){return f(e.target.value)},required:!0})]}),Object(b.jsx)(D.a,{variant:"contained",type:"submit",onSubmit:v,disableElevation:!0,className:c.button,children:"Register"})]}),Object(b.jsxs)(Be.a,{className:c.helperText,children:["Already a user? Click"," ",Object(b.jsx)(d.b,{to:"/login",className:c.link,children:"here"})," ","to login now!"]})]})},Ke=n(590),qe=n(575),Ve=n(561),_e=n(565),ze=n(560),$e=n(563),Qe=n(562),Xe=n(329),Ze=n.n(Xe),et=function(){return Object(b.jsx)(Ze.a,{dataOnauth:function(e){var t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","telegram/login");fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.first_name,chatId:e.id}),credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success||console.log(e)}))},botName:"NUSFitness_Bot"})},tt=Object(N.a)((function(e){return{root:{padding:e.spacing(4)},container:Object(p.a)({},e.breakpoints.down("sm"),{flexDirection:"column",alignItems:"inherit"}),tableContainer:{width:"inherit"},circularProgress:{margin:"0 auto",color:ee.a[200]},profileBox:{border:"1px solid grey",borderRadius:12},avatar:{width:200,height:200,marginTop:e.spacing(2),marginBottom:e.spacing(1)},info:{marginTop:e.spacing(1),marginBottom:e.spacing(2)},chip:{marginTop:e.spacing(2)},telegramLogin:Object(p.a)({marginTop:e.spacing(2)},e.breakpoints.down("sm"),{marginBottom:e.spacing(2)})}})),nt=function(e){e.handleAlert;var t=e.loggedIn,n=tt(),c=Object(a.useState)([]),o=Object(i.a)(c,2),s=o[0],r=o[1],l=Object(a.useState)(),u=Object(i.a)(l,2),d=u[0],j=u[1],h=Object(a.useState)(),m=Object(i.a)(h,2),f=m[0],p=m[1],x=Object(a.useState)(),y=Object(i.a)(x,2),v=y[0],k=y[1],w=Object(a.useState)({}),S=Object(i.a)(w,2),C=S[0],T=S[1],D=Object(a.useState)(),N=Object(i.a)(D,2),L=N[0],E=N[1],I=Object(a.useMemo)((function(){return d||f||v}),[d,f,v]);return Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","bookedSlots");j(!0),fetch(e,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){r(e.map((function(e){return{facility:e.facility,date:new Date(e.date)}}))),j(!1)})).catch((function(e){j(!1),console.log(e)}))}),[]),Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","profile");k(!0),fetch(e,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){T(e),k(!1)})).catch((function(e){k(!1),console.log(e)}))}),[]),Object(a.useEffect)((function(){function e(){return(e=Object(K.a)(Y.a.mark((function e(){var t,n,a;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","creditsLeft"),p(!0),e.next=4,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,E(a.credits),p(!1);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(b.jsx)("div",{className:n.root,children:t?I?Object(b.jsx)(O.a,{display:"flex",mt:1.5,justifyContent:"center",children:Object(b.jsx)(_.a,{className:n.circularProgress})}):Object(b.jsxs)(O.a,{display:"flex",justifyContent:"center",className:n.container,alignItems:"flex-start",children:[Object(b.jsxs)(O.a,{ml:2,mr:2,flex:3,display:"flex",flexDirection:"column",children:[Object(b.jsxs)(O.a,{display:"flex",alignItems:"center",flexDirection:"column",className:n.profileBox,children:[Object(b.jsx)(Ke.a,{src:"https://robohash.org/".concat(C.email,"?set=set5"),className:n.avatar}),Object(b.jsx)(g.a,{variant:"h6",children:C.email}),Object(b.jsx)(O.a,{className:n.info,display:"flex",flexDirection:"column",alignItems:"center",children:Object(b.jsxs)(g.a,{children:[Object(b.jsx)("strong",{children:"Joined:"})," ",new Date(C.joined).toLocaleDateString()]})})]}),Object(b.jsx)(V.a,{className:n.chip,label:Object(b.jsxs)(g.a,{children:[Object(b.jsx)("strong",{children:"Remaining credits this week:"})," ",L]})}),Object(b.jsx)(O.a,{display:"flex",justifyContent:"center",className:n.telegramLogin,children:Object(b.jsx)(et,{})})]}),Object(b.jsxs)(O.a,{ml:2,mr:2,display:"flex",flexDirection:"column",flex:7,children:[Object(b.jsx)(O.a,{display:"flex",justifyContent:"center",mb:1,children:Object(b.jsx)(g.a,{variant:"h4",children:"My Bookings"})}),Object(b.jsx)(qe.a,{className:n.tableContainer,component:q.a,children:Object(b.jsxs)(Ve.a,{children:[Object(b.jsx)(_e.a,{children:Object(b.jsxs)(ze.a,{children:[Object(b.jsx)($e.a,{children:"Facility"}),Object(b.jsx)($e.a,{align:"right",children:"Date"}),Object(b.jsx)($e.a,{align:"right",children:"Time"})]})}),Object(b.jsx)(Qe.a,{children:!I&&s.map((function(e){return Object(b.jsxs)(ze.a,{children:[Object(b.jsx)($e.a,{component:"th",scope:"row",children:e.facility}),Object(b.jsx)($e.a,{align:"right",children:e.date.toDateString()}),Object(b.jsx)($e.a,{align:"right",children:e.date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","")})]},e.facility)}))})]})}),!s.length&&Object(b.jsx)(O.a,{display:"flex",mt:1.5,justifyContent:"center",children:Object(b.jsx)("span",{children:"No bookings found."})})]})]}):Object(b.jsx)(U,{})})},at=Object(r.a)({palette:{primary:{main:u.a[700]}},overrides:{MuiButton:{contained:{backgroundColor:"#337ab7","&:hover":{backgroundColor:"#286090"},color:"white"}},MuiFormLabel:{root:{"&$focused":{color:"#337ab7"}}},MuiInput:{underline:{"&:after":{borderBottom:"2px solid #337ab7"}}}}}),ct=function(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),s=Object(i.a)(o,2),r=s[0],u=s[1],h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;c({msg:e,type:t}),setTimeout((function(){c(null)}),n)};return Object(a.useEffect)((function(){var e="".concat("local.nusfitness.com"===window.location.hostname?"http://local.nusfitness.com:5000/":"https://salty-reaches-24995.herokuapp.com/","isLoggedIn");fetch(e,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){u(e.authenticated)})).catch((function(e){console.log(e),u(!1)}))}),[]),Object(b.jsx)(l.a,{theme:at,children:Object(b.jsx)(d.a,{basename:"/nusfitness",children:Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(Je,{loggedIn:r,setLoggedIn:u}),Object(b.jsx)(m,{alert:n}),Object(b.jsxs)(j.c,{children:[Object(b.jsx)(j.a,{exact:!0,path:"/dashboard",children:Object(b.jsx)(U,{})}),Object(b.jsx)(j.a,{exact:!0,path:"/profile",children:Object(b.jsx)(nt,{handleAlert:h,loggedIn:r})}),Object(b.jsx)(j.a,{exact:!0,path:"/register",children:Object(b.jsx)(Ye,{handleAlert:h,loggedIn:r,setLoggedIn:u})}),Object(b.jsx)(j.a,{exact:!0,path:"/login",children:Object(b.jsx)(Pe,{handleAlert:h,loggedIn:r,setLoggedIn:u})}),Object(b.jsx)(j.a,{exact:!0,path:"/",children:Object(b.jsx)(Ae,{handleAlert:h,loggedIn:r,setLoggedIn:u})})]})]})})})};s.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(ct,{})}),document.getElementById("root"))}},[[490,1,2]]]);
//# sourceMappingURL=main.930634f0.chunk.js.map